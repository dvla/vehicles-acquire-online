@(viewModel: models.AcquireCompletionViewModel, surveyUrl: Option[String])(implicit lang: Lang,
    token: uk.gov.dvla.vehicles.presentation.common.filters.CsrfPreventionAction.CsrfPreventionToken,
    config: utils.helpers.Config)

@import controllers.routes.SetUpTradeDetails
@import scala.collection.mutable.LinkedHashMap
@import uk.gov.dvla.vehicles.presentation.common
@import views.html.helper.form
@import views.acquire.AcquireSuccess.{BuyAnotherId, FinishId}
@import common.views.html.widgets.alertWarning
@import common.views.html.widgets.alertSuccess
@import common.views.html.widgets.base.csrfTokenHiddenField
@import common.views.html.widgets.playbackList
@import views.acquire.BeforeYouStart.NextId

@main(
    progress = Some(Messages("acquire_progress_9")),
    title = "Summary"
) {

<div class="two-col clearfix acquire-success">
    <div class="second-col">

        @alertSuccess(Some(Messages("acquire_success.complete.header"))){
            <p>@Messages("acquire_success.complete.p1")</p>
            @alertWarning() {
                <p><strong>@Messages("acquire_success.complete.p2")</strong></p>
            }
        }
        <h2>@Messages("acquire_success.further_information.header")</h2>

        <ul>
            <li>@Messages("acquire_success.further_information.p1")</li>
            <li>@Messages("acquire_success.further_information.p2")</li>
        </ul>

        @alertWarning() {
            <p><strong>@Messages("acquire_success.further_information.alert")</strong></p>
        }

        <div class="form-steps desktop-only">
            <div class="step">
                <button id="printDisposalSuccess"
                        type="button"
                        name="action"
                        value="printDisposalSuccess"
                        class="button js-only print-button">
                    @Messages("acquire_success.buttonnavprint")
                </button>
            </div>
            <div class="step">
                @form(action = controllers.routes.AcquireSuccess.buyAnother()) {
                @csrfTokenHiddenField()
                <button id="@BuyAnotherId"
                        type="submit"
                        name="action"
                        data-tracking="summary_action"
                        class="button button-new-disposal button-secondary success-buy-another-btn">
                    @Messages("acquire_success.buyAnother")
                </button>
                }
            </div>
            <div class="step">
                @form(action = controllers.routes.AcquireSuccess.finish()) {
                @csrfTokenHiddenField()
                @surveyUrl match {
                case Some(url) => {
                <button id="@FinishId"
                        type="submit"
                        name="action"
                        onclick="window.open('@url', '_blank');"
                        data-tracking="summary_action"
                        class="button button-new-disposal button-secondary success-finish-btn">
                    @Messages("acquire_success.finish")
                </button>
                }
                case None => {
                <button id="@FinishId"
                        type="submit"
                        name="action"
                        data-tracking="summary_action"
                        class="button button-new-disposal button-secondary success-finish-btn">
                    @Messages("acquire_success.finish")
                </button>
                }
                }
                }
            </div>
        </div>
    </div>

    <div class="first-col">

        @playbackList(
            Messages("acquire_success.transaction_details.header"),
            {
                val playbackItems: LinkedHashMap[String, String] = LinkedHashMap()
                playbackItems += (Messages("acquire_success.transaction_details.transaction_id") -> viewModel.completeAndConfirmResponseModel.transactionId)
                playbackItems += (Messages("acquire_success.transaction_details.transaction_date") -> viewModel.completeAndConfirmResponseModel.transactionTimestamp.toString("dd/MM/yyyy"))
            },
            List("transaction-details")
        )()

        @playbackList(
            Messages("acquire_success.vehicle_details.p1"),
            {
                val playbackItems: LinkedHashMap[String, String] = LinkedHashMap()
                val flaggedRegNumberLabel: String = "REG_" + Messages("acquire_success.vehicle_details.registration_number")
                playbackItems += (flaggedRegNumberLabel -> viewModel.vehicleDetails.registrationNumber)

                viewModel.vehicleDetails.make match {
                    case Some(make) => playbackItems += (Messages("acquire_success.vehicle_details.make") -> make)
                    case None => playbackItems
                }

                viewModel.vehicleDetails.model match {
                    case Some(model) => playbackItems += (Messages("acquire_success.vehicle_details.model") -> model)
                    case None => playbackItems
                }

                if(viewModel.completeAndConfirmDetails.mileage == None) {
                    playbackItems += (Messages("acquire_success.vehicle_details.mileage") -> Messages("acquire_success.vehicle_details.mileage_not_entered"))
                } else {
                    playbackItems += (Messages("acquire_success.vehicle_details.mileage") -> java.text.NumberFormat.getIntegerInstance().format(viewModel.completeAndConfirmDetails.mileage.get))
                }
            },
            List("related")
        ) {
            <dt>@Messages("acquire_success.vehicle_details.taxOrSorn")</dt>
            @if(viewModel.vehicleSorn.sornVehicle == None) {
                <dd class="tax-or-sorn">@Messages("acquire_success.vehicle_details.sornNotEntered")</dd>
            } else {
                <dd class="tax-or-sorn">
                @Messages(
                    "acquire_success.vehicle_details.sornEntered",
                    viewModel.completeAndConfirmResponseModel.transactionTimestamp.toString("dd/MM/yyyy")
                )
                </dd>
                <dd class="word-wrap-only tax-or-sorn-sub">@Messages("acquire_success.vehicle_details.sornEntered.p1")</dd>
            }
        }

        <div class="acquire-success-summary-playback">
            <div class="vehicle-sold-by">
                @playbackList(
                    Messages("acquire_success.trader_details.header"),
                    {
                        val playbackItems: LinkedHashMap[String, String] = LinkedHashMap()
                        playbackItems += (Messages("acquire_success.trader_details.trader_name") -> viewModel.traderDetails.traderName)
                        playbackItems += (Messages("acquire_success.trader_details.trader_address") -> viewModel.traderDetails.traderAddress.address.mkString("<br/>"))
                    },
                    List("bg-plain")
                ){
                    <dt>@Messages("acquire_success.trader_details.trader_email")</dt>
                    @if(viewModel.traderDetails.traderEmail == None) {
                        <dd>@Messages("acquire_email_not_entered")</dd>
                    } else {
                        <dd><span class="lowercase-text">@viewModel.traderDetails.traderEmail.get</span></dd>
                    }
                    <dt>@Messages("acquire_success.date_of_sale.label")</dt>
                    <dd>@viewModel.completeAndConfirmDetails.dateOfSale.toString("dd/MM/yyyy")</dd>
                }
            </div>

            @playbackList(
                Messages("acquire_success.new_keeper_details.p1"),
                {
                    val playbackItems: LinkedHashMap[String, String] = LinkedHashMap()
                    playbackItems += (Messages("acquire_success.vehicle_details.name") -> viewModel.newKeeperDetails.displayName)
                    playbackItems += (Messages("acquire_success.vehicle_details.address") -> viewModel.newKeeperDetails.address.address.mkString("<br/>"))
                },
                List("bg-plain")
            ){
                <dt>@Messages("acquire_success.vehicle_details.email")</dt>
                @if(viewModel.newKeeperDetails.email == None) {
                    <dd>@Messages("acquire_email_not_entered")</dd>
                } else {
                    <dd><span class="lowercase-text">@viewModel.newKeeperDetails.email.get</span></dd>
                }
            }
        </div>
    </div>

    <div class="form-steps mobile-only">
        <div class="step">
            <button id="printDisposalSuccessMobile"
                    type="button"
                    name="action"
                    value="printDisposalSuccess"
                    class="button js-only print-button">
                @Messages("acquire_success.buttonnavprint")
            </button>
        </div>
        <div class="step">
            @form(action = controllers.routes.AcquireSuccess.buyAnother()) {
            @csrfTokenHiddenField()
            <button id="@BuyAnotherId"
                    type="submit"
                    name="action"
                    data-tracking="summary_action"
                    class="button button-new-disposal button-secondary success-buy-another-btn">
                @Messages("acquire_success.buyAnother")
            </button>
            }
        </div>
        <div class="step">
            @form(action = controllers.routes.AcquireSuccess.finish()) {
            @csrfTokenHiddenField()
            @surveyUrl match {
            case Some(url) => {
            <button id="@FinishId"
                    type="submit"
                    name="action"
                    onclick="window.open('@url', '_blank');"
                    data-tracking="summary_action"
                    class="button button-new-disposal button-secondary success-finish-btn">
                @Messages("acquire_success.finish")
            </button>
            }
            case None => {
            <button id="@FinishId"
                    type="submit"
                    name="action"
                    data-tracking="summary_action"
                    class="button button-new-disposal button-secondary success-finish-btn">
                @Messages("acquire_success.finish")
            </button>
            }
            }
            }
        </div>
    </div>
</div>
}
