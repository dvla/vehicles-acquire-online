@(data: models.PrivateKeeperDetailsCompleteViewModel,
  dateService: uk.gov.dvla.vehicles.presentation.common.services.DateService)(implicit lang: Lang,
  token: uk.gov.dvla.vehicles.presentation.common.filters.CsrfPreventionAction.CsrfPreventionToken,
  config: utils.helpers.Config)

@import views.html.helper.form
@import controllers.routes.PrivateKeeperDetailsComplete
@import uk.gov.dvla.vehicles.presentation.common
@import common.mappings.Mileage
@import common.views.html.widgets.dates.valtechDate
@import common.views.html.widgets.dates.inputDayMonthYearTextbox
@import common.views.html.widgets.base.csrfTokenHiddenField
@import common.views.helpers.BaseTemplate.fieldConstructor
@import common.views.html.widgets.base.{valtechInputText, valtechDeclareCheck}
@import models.PrivateKeeperDetailsCompleteFormModel.Form.{DateOfBirthId, MileageId, ConsentId, DateOfSaleId, TodaysDateId}
@import views.acquire.PrivateKeeperDetailsComplete.{BackId, SubmitId}

@main(
    progress = Some(Messages("acquire_progress_7")),
    title = Messages("acquire_keeperdetailscomplete.title"),
    currentForm = Some(data.form)
) {
    @form(action = PrivateKeeperDetailsComplete.submit) {
        @csrfTokenHiddenField()

        <p>@Messages("acquire_keeperdetailscomplete.p1")</p>

        <script src="@routes.Assets.at("lib/vehicles-presentation-common/javascripts/autofill-todays-date.js")" type="text/javascript"></script>

        @valtechDate(
            data.form(DateOfBirthId),
            Messages("privatekeeper_dateofbirth"),
            Some(Messages("acquire_privatekeeperdetailscomplete.dateofbirth.hint")
        ))

        @valtechInputText(
            data.form(MileageId), args =
            Map('_label -> Messages("acquire_keeperdetailscomplete.mileage.label"),
                '_showConstraints -> false,
                'typeTel -> true,
                'maxLength -> Mileage.MaxLength // Must be set independently of the pattern as the pattern is only checked when the user submits.
                //'title -> Messages("acquire_keeperdetailscomplete.mileage.validation")
            ) ++
            (if(config.isHtml5ValidationEnabled) Map('pattern -> Mileage.Pattern) else Nil)
        )

        <div id=@DateOfSaleId>
            @inputDayMonthYearTextbox(
                field = data.form(DateOfSaleId),
                years = dateService.today.yearRangeToDropdown(yearsIntoThePast = 10),
                args = Map(
                    '_label -> Messages("privatekeeper_dateofsale"),
                    'autofocus -> true
                ),
                dateService = dateService,
                showTodaysDateButton = true,
                showTodaysDateButtonId = Some(TodaysDateId)
            )
        </div>

        @valtechDeclareCheck(
            data.form(ConsentId),
            args = Map(
                '_showConstraints -> false,
                '_label -> Messages("acquire_keeperdetailscomplete.consent")
            )
        )

        <div class="second-col">
            <div class="form-steps">
                <button id="@SubmitId" type="submit" name="action" class="button">
                    @Messages("acquire_keeperdetailscomplete.submitbutton")
                </button>
                <a id="@BackId" href="@controllers.routes.PrivateKeeperDetails.present()" class="button-secondary">
                    @Messages("acquire_keeperdetailscomplete.backbutton")
                </a>
            </div>
        </div>
    }
}

