@(viewModel: models.VehicleTaxOrSornViewModel
)(implicit lang: Lang,
  token: uk.gov.dvla.vehicles.presentation.common.filters.CsrfPreventionAction.CsrfPreventionToken,
  config: utils.helpers.Config
)

@import controllers.routes.VehicleTaxOrSorn
@import models.VehicleTaxOrSornFormModel.Form.{SornVehicleId, SelectId}
@import uk.gov.dvla.vehicles.presentation.common
@import common.views.helpers.BaseTemplate.fieldConstructor
@import common.views.html.widgets.base.csrfTokenHiddenField
@import common.views.html.widgets.base.valtechDeclareCheck
@import common.views.html.widgets.listRadioGroup
@import views.acquire.VehicleTaxOrSorn.{BackId, SubmitId}
@import views.html.acquire.main
@import views.html.helper.form
@import views.html.common.vehicle_detail_playback

@main(
    progress = Some(Messages("acquire_progress_7")),
    title = Messages("acquire_vehicleTaxOrSorn_title"),
    currentForm = Some(viewModel.form)
) {

<h1>@Messages("acquire_vehicleTaxOrSorn_title")</h1>

<div class="two-col clearfix" xmlns="http://www.w3.org/1999/html">
    <div class="first-col">
        <dl class="playback">
            <dt><h2>@Messages("acquire_vehicleTaxOrSorn.newkeeperDetails")</h2></dt>
            <dt>@Messages("acquire_vehicleTaxOrSorn.displayName")</dt>
            <dd>@viewModel.keeperDetails.displayName</dd>
            <dt>@Messages("acquire_vehicleTaxOrSorn.address")</dt>
            <dd>@for(addr <- viewModel.keeperDetails.address.address) {@addr<br/>}</dd>
            <dt>@Messages("acquire_vehicleTaxOrSorn.email")</dt>
            @if(viewModel.keeperDetails.email == None) {
                <dd>@Messages("acquire_vehicleTaxOrSorn.emailNotEntered")</dd>
            } else {
                <dd>@viewModel.keeperDetails.email.get</dd>
            }
            @if(viewModel.keeperDetails.isBusinessKeeper) {
                <dt>@Messages("acquire_vehicleTaxOrSorn.fleetNumber")</dt>
                @if(viewModel.keeperDetails.fleetNumber == None) {
                    <dd>@Messages("acquire_vehicleTaxOrSorn.fleetNumberNotEntered")</dd>
                } else {
                    <dd>@viewModel.keeperDetails.fleetNumber.get</dd>
                }
            }
        </dl>
        @vehicle_detail_playback(viewModel.vehicleAndKeeperDetails)
    </div>

    <div class="second-col">
        <p>@Messages("acquire_vehicleTaxOrSorn.p1")</p>
        <p>Do you want to:</p>

        @form(action = VehicleTaxOrSorn.submit()) {
            @csrfTokenHiddenField()

            @defining(viewModel.form.data) { form =>

                <!-- option group -->
                <div class="expandable-optional
                @if(viewModel.errorType == NoSelection || (viewModel.errorType == NoSorn && form.get("select").exists(_ != "S"))) {
                    form-item validation
                } sorn-tax-radio-wrapper">
                    @if(viewModel.errorType == NoSelection) {
                        <p class="error">@Messages("acquire_vehicleTaxOrSorn.selectidError")</p>
                    }
                    @if(viewModel.errorType == NoSorn && form.get("select").exists(_ != "S")) {
                        <p class="error">@Messages("error.nosornformerror")</p>
                    }
                    <fieldset>
                        <div class="radio" id="select">
                            <div class="form-item">
                                <label class="form-radio selectable" for="tax">
                                    <input id="tax" class="option-visible" name="select" type="radio"
                                    @if(form.get("select").exists(_ == "T")) { checked }
                                    aria-required="true" value="T" autofocus="true"/><span>Tax Vehicle</span>
                                </label>
                                <label class="form-radio selectable" for="sorn">
                                    <input id="sorn" class="option-visible" name="select" type="radio"
                                    @if(form.get("select").exists(_ == "S")) {
                                        checked }
                                    aria-required="true" value="S"/><span>SORN now</span>
                                </label>
                                <label class="form-radio selectable" for="neither">
                                    <input id="neither" class="option-visible span" name="select" type="radio"
                                    @if(form.get("select").exists(_ == "N")) { checked }
                                    aria-required="true" value="N"/><span>Neither</span>
                                </label>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <!-- Shown when tax is selected -->
                <div class="tax-text panel-indent-wrapper">
                    <div id="tax_details" class="panel-indent">
                        <a class="large" href="https://www.gov.uk/tax-disc" target="_blank">@Messages("acquire_vehicleTaxOrSorn.link")</a>
                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.taxText")</p>
                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.taxText-2")</p>
                    </div>
                </div>

                <!-- Shown when sorn is selected -->
                <div class="sorn-text panel-indent-wrapper ">
                    <div id="sorn_details" class="@if(viewModel.errorType == NoSorn) {form-item validation} else {panel-indent}">
                        @if(viewModel.errorType == NoSorn && form.get("select").exists(_ == "S")) {
                            <p class="error">@Messages("error.sornformerror")</p>
                        }

                        @if(viewModel.errorType == NoSorn && form.get("select").exists(_ != "S")) {
                            <p class="error">@Messages("error.nosornformerror")</p>
                        }

                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.sornText")</p>
                        @valtechDeclareCheck(viewModel.form(SornVehicleId),
                            args = Map(
                                '_showConstraints -> false,
                                'autofocus -> true,
                                'NO_OPTIONAL_LABEL -> true,
                                '_label -> Messages("acquire_vehicleTaxOrSorn.sornVehicle")
                            )
                        )
                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.sornText-p1")</p>
                    </div>
                </div>

                <!-- Shown when neither is selected -->
                <div class="neither-text panel-indent-wrapper">
                    <div id="neither_details" class="panel-indent">

                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.neitherText.p1")</p>
                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.neitherText.p2")</p>
                        <p class="form-hint">@Messages("acquire_vehicleTaxOrSorn.neitherText.p3")</p>
                    </div>
                </div>
            }

            <!-- Next and back buttons -->
            <div class="form-steps">
                    <button id="@SubmitId" type="submit" name="action" class="button">
                        @Messages("acquire_vehicleTaxOrSorn.submitbutton")
                    </button>
                    <br/>
                    <a class="back" id="@BackId" href="@controllers.routes.VehicleTaxOrSorn.back()">
                        @Messages("acquire_vehicleTaxOrSorn.backbutton")
                    </a>
            </div>
        }
    </div>
</div>
}